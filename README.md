# NYH smart temp
## ภาพรวม
การทำงานของการเก็บข้อมูลจากเซนเซอร์อุณหภูมิความชื้น จะใช้บอร์ดไมโครคอนโทรลเลอร์ ESP8266 ซึ่งเขียนด้วยภาษา c++ บน Arduino IDE สำหรับเชื่อมต่อกับระบบไวไฟและส่งค่าข้อมูลขึ้นไปเก็บที่เว็บเซิร์ฟเวอร์ โดยการส่งข้อมูลจะส่งโดยใช้โปรโตคอล http post request ไปยังเว็บเซิร์ฟเวอร์ ทางด้านเว็บจะใช้ภาษา php สำหรับรับข้อมูลจากอุปกรณ์ ESP8266 และจะเก็บข้อมูลเป็น Time series ดาต้าเบสบน sqlite สำหรับแต่ละอุปกรณ์จะมีดาต้าเบสเป็นชื่อของ ESP ID
## อุปกรณ์เซนเซอร์
		 1.บอร์ดไมโครคอนโทรลเลอร์ WEMOS D1 mini ใช้ชิป ESP8266
เป็นบอร์ดไมโครคอนโทรลเลอร์ที่เขียนด้วยภาษา C++ และทำงานบน Arduino IDE ที่สามารถเชื่อมต่อกับไวไฟได้ ทำให้สะดวกกับการส่งข้อมูลไร้สายได้

สำหรับบอร์ด ESP8266 จะมีสเปคดังนี้

![ESP8266 Specification](docs/Screenshot%202023-06-13%20125533.png)

![Wemos d1 mini](docs/wemos.png)		

		 2. เซนเซอร์อุณหภูมิตู้แช่ NTC ขนาด 10KΩ
NTC (Negative Temperature Coefficient) คือ เซ็นเซอร์วัดอุณหภูมิประเภทเทอร์มิสเตอร์ (Thermistor) เมื่ออุณหภูมิสูงขึ้น ค่าความต้านทาน (Resistance) จะลดลง (ค่าความต้านทานจะมีค่าเป็น กิโลโอห์ม (KΩ) เช่น 2KΩ, 10KΩ) โดยมีย่านการวัดอุณหภูมิ -30 ํC ถึง 130 ํC

หลักการทำงานของเซนเซอร์ NTCคือ เมื่ออุณหภูมิต่ำลง ความต้านทานจะเพิ่มขึ้น ซึ่งสามารถใช้งานในการวัดและตรวจจับอุณหภูมิได้ โดยนำ NTC มาต่อกับตัวต้านทานค่าคงที่ และต่อกับแหล่งจ่ายไฟ จะทำให้เป็นวงจรแบ่งแรงดัน(Voltage divider circuit) โดยเมื่อค่าความต้านทานของ NTC เปลี่ยนไป จะทำให้ค่าความต้านทานเปลี่ยนไปนั่นเอง

ในโปรเจคนี้จะใช้ NTC ขนาด10KΩ (ที่อุณหภูมิ 25 ํC จะมีความต้านทาน 10KΩ) มาต่ออนุกรมกับตัวต้านทานคงที่ขนาด 10KΩ แล้วนำไปต่อกับแหล่งจ่าย 3.3v จากบอร์ด wemos d1 mini และต่อจุดระหว่าง ntc และตัวต้านทาน10KΩ เข้าไปยังขา ADC ของบอร์ด เพื่อวัดแรงดันที่เปลี่ยนไป โดยคำนวณจากสมการแบ่งแรงดันไฟฟ้า ก็จะได้อุณภูมิขณะนั้นออกมาได้นั่นเอง

สรุปได้ว่าเซ็นเซอร์ NTC ถูกออกแบบมาเพื่อวัดอุณหภูมิ โดยใช้ค่าความต้านทานของเซนเซอร์ในการตรวจวัด และนำข้อมูลความต่างศักย์ที่ได้ไปแปลงเป็นค่าอุณหภูมิที่ถูกต้องตามมาตรฐานหรือสูตรที่กำหนดไว้ในระบบวัดอุณหภูมิ

		 3. เซนเซอร์อุณหภูมิความชื้นในอากาศ DHT22
DHT22 เป็นเซ็นเซอร์ที่ใช้ในการวัดอุณหภูมิและความชื้นในสภาพแวดล้อม โดยมีหลักการทำงานที่คล้ายคลึงกับเซ็นเซอร์ NTC แต่มีความสามารถในการวัดค่าความชื้นเพิ่มเติม

เซ็นเซอร์ DHT22 ประกอบด้วยองค์ประกอบสำคัญสองส่วน คือ เซ็นเซอร์อุณหภูมิ (Temperature Sensor) และเซ็นเซอร์ความชื้น (Humidity Sensor) ซึ่งองค์ประกอบทั้งสองนี้อยู่ในตัวเดียวกัน

ตัวเซนเซอร์จะสื่อสารกับบอร์ดไมโครคอนโทรลเลอร์ด้วย 1-wire communication โดยต่อเข้ากับขา D7 ของบอร์ด

		 4. จอแสดงผล OLED SSD1306
จอ OLED SSD1306 เป็นจอแสดงผลแบบ OLED (Organic Light-Emitting Diode) ที่มีขนาดเล็กและใช้เทคโนโลยี OLED ในการแสดงภาพ ซึ่งเป็นเทคโนโลยีที่ใช้วัสดุอินทราคติกซึ่งสามารถส่องแสงออกมาเองเมื่อได้รับกระแสไฟฟ้า โดยไม่จำเป็นต้องใช้แสงหลอด LED หรือหลอดฟลูออเรสเซนต์เหมือนกับจอแสดงผลอื่น ๆ

SSD1306 เป็นชิปควบคุมสำหรับจอ OLED ซึ่งใช้ในการส่งข้อมูลและควบคุมการแสดงผลบนจอ OLED ได้อย่างง่ายดาย ชิปนี้รองรับการแสดงผลข้อความและภาพเล็ก ๆ ได้ในรูปแบบต่าง ๆ ซึ่งสามารถสร้างกราฟิกและแสดงผลข้อมูลได้อย่างครบถ้วน

จอ OLED SSD1306 มีความละเอียดสูงและความสว่างที่ดี โดยสามารถแสดงภาพแบบคมชัดและสีสันสดใสได้ และมีอินเทอร์เฟซที่ใช้งานง่าย เช่น I2C (Inter-Integrated Circuit) หรือ SPI (Serial Peripheral Interface) เพื่อการสื่อสารกับไมโครคอนโทรลเลอร์หรือบอร์ดควบคุมอื่น ๆ

จอ OLED SSD1306 จะถูกใช้ในโปรเจคตัววัดอุณหภูมิและความชื้นของอากาศ ซึ่งจะแสดงได้ทั้งค่าอุณหภูมิความชื้น และสถานะอุปกรณ์เกี่ยวกับการเชื่อมต่อเน็ตเวิร์คในขณะนั้นได้ละเอียด โดยที่สามารถรู้ปัญหาและรายละเอียดมากขึ้น โดยที่ไม่ต้องต่อกับคอมพิวเตอร์เพื่อดูปัญหาได้  ซึ่งตัวจอจะใช้ขา D1 D2 ซึ่งเป็นขา I2C สื่อสารสารกับบอร์ด

		 5. จอ tm1637
จอ TM1637 เป็นจอแสดงผลที่ใช้เทคโนโลยี LED ในการแสดงตัวเลขหรือสัญลักษณ์ต่าง ๆ โดยเฉพาะ ซึ่งมีความสามารถในการแสดงผลเลขหลายตัวพร้อมกันได้ และมีอินเทอร์เฟซที่ใช้ง่าย เช่น สายจับคู่กับไมโครคอนโทรลเลอร์หรือบอร์ดควบคุมอื่น ๆ

จอ TM1637 มาพร้อมกับชิปควบคุม TM1637 ที่ทำหน้าที่ส่งข้อมูลและควบคุมการแสดงผลบนจอ ชิปนี้รองรับการแสดงผลตัวเลข 7 หลัก โดยมีแต่ละหลักประกอบด้วยโดดจังหวะ 7 ดวงที่ใช้สร้างตัวเลข 0-9 และสัญลักษณ์อื่น ๆ เช่น (-), (.), (A), (B), (C) เป็นต้น

การใช้งานจอ TM1637 จำเป็นต้องส่งข้อมูลเพื่อกำหนดตำแหน่งและตัวอักษรหรือสัญลักษณ์ที่ต้องการแสดงผล โดยใช้โปรโตคอลการสื่อสาร I2C (Inter-Integrated Circuit) เพื่อส่งข้อมูลจากไมโครคอนโทรลเลอร์หรือบอร์ดควบคุมไปยังจอ TM1637

จอ TM1637 ถูกใช้ในโปรเจคแสดงอูณหภูมิของตู้แช่ ซึ่งจะสะดวกในการใช้งานเพราะมีขนาดตัวอักษรที่ไม่เล็กจนเกินไป สามารถถอดเสียบ หรือย้ายไปอุปกรณ์ตัวอื่นได้ทันที ซึ่งตัวจอจะใช้ขา D1 D2 ซึ่งเป็นขา I2C สื่อสารสารกับบอร์ด
		 
## โค้ดและการทำงานของบอร์ดและเซนเซอร์
โค้ดสำหรับใช้งานกับบอร์ด Wemos D1 mini จะอยู่ใน [github](https://github.com/canusorn/ntc_temp)

โดยจะมีโค้ด2ตัวคือ
 1. NTC
 3. DHT22

#### โค้ด NTC
จะใช้การต่อวงจร โดย Rs 10KΩ และ Rt คือ NTC ขนาด 10KΩ Vin ต่อกับ 3.3v และ Vout ต่อเข้าขา A0 ของบอร์ด เพื่อวัดแรงดันที่เกิดจากการแบ่งแรงดันในวงจร
![enter image description here](https://user-images.githubusercontent.com/5845622/74078289-cb689f00-4a28-11ea-9d00-753c6b8aea1c.gif)

โค้ดสำหรับแปลงค่าจาก ADC ขา A0 ของบอร์ดเป็นอุณหภูมิจะเป็นดังนี้

    float Rt = (float)(1023 * 9940) / Vtf - 9940;
    float ln = log(Rt / 10000);
    temp = (1 / ((ln / 3950) + (1 / (25 + 273.15))));
    temp -= 273.15;

โดยจะมีการแปลง log ด้วย เนื่องจากกราฟระหว่างความต้านทานต่ออุณหภูมิจะเป็นกราฟ logarithm ตามรูปภาพด้านล่างนี้
![enter image description here](https://www.researchgate.net/publication/329896189/figure/fig6/AS:707448700665858@1545680322099/NTC-Thermistor-characteristic-curve-Resistance-R-vs-Temperature-T.png)

#### โค้ด DHT22
สำหรับโค้ด DHT22 จะไม่ซับซ้อนเนื่องจากมีไลบรารี่ให้ใช้งานได้เลย
สำหรับการต่อใช้งาน จะต่อขาสัญญาณเข้ากับ D7 บนบอร์ด เพื่อสื่อสารข้อมูลระหว่างเซนเซอร์และบอร์ด


## เว็บเซิร์ฟเวอร์สำหรับเก็บข้อมูล
	 1. โค้ดและการทำงาน

	 2. ติดตั้งบนเว็บโฮสติ้ง
